# E2Eテスト一覧

**作成日:** 2025-10-30
**バージョン:** 1.0
**対象システム:** TODO アプリケーション

---

## 1. はじめに

### 1.1 本ドキュメントの目的

本ドキュメントは、TODOアプリケーションのE2E（End-to-End）テストシナリオを一覧化します。ユーザーの実際の操作フローを再現し、アプリケーション全体の動作を検証するテストケースを定義します。

### 1.2 対象読者

- QAエンジニア
- 開発者全般（フロントエンド、バックエンド）
- テックリード、アーキテクト

**関連ドキュメント:**
- [テスト戦略書](./06_testing-strategy.md) - テストレベル、テストピラミッド
- [機能一覧](./03_feature-list.md) - テスト対象機能
- [システム構成設計書](./01_system-architecture.md) - システムアーキテクチャ

---

## 2. E2Eテスト概要

### 2.1 E2Eテストの目的

E2Eテストは、アプリケーション全体（フロントエンド + バックエンド + データベース）を統合的にテストし、実際のユーザー体験を検証します。

**主な目的:**
- ユーザーの実際の操作フローが正しく動作することを確認
- システム全体の統合動作を検証
- クリティカルなビジネスフローが壊れていないことを保証
- リグレッション検知（既存機能の破壊を防止）

### 2.2 テストツール

| ツール | 用途 | 実装状況 |
|-------|------|---------|
| **Playwright** | ブラウザ自動化 | 未実装 |
| **MCP Playwright** | Claude Code統合 | 利用可能 |

### 2.3 テスト実行タイミング

| タイミング | 説明 |
|-----------|------|
| **プルリクエスト作成時** | クリティカルパステストのみ実行 |
| **mainブランチマージ前** | 全E2Eテストを実行 |
| **リリース前** | 全E2Eテストを実行 + 手動スモークテスト |
| **ローカル開発** | 影響範囲のテストを手動実行 |

---

## 3. テスト環境

### 3.1 環境構成

**テスト実行環境:**
```
ブラウザ（Playwright）
    ↓ HTTP
フロントエンド（React + Vite）
    ↓ REST API
バックエンド（Flask）
    ↓ SQL
データベース（MySQL）
```

**前提条件:**
- Docker Composeでフルスタックが起動していること
- テスト用ユーザーが事前に作成されていること
- データベースが初期状態であること

### 3.2 テストデータ

**テストユーザー:**
| ユーザー | メールアドレス | パスワード | 用途 |
|---------|--------------|----------|------|
| User A | `e2e-user-a@example.com` | `TestPassword123` | 基本フローテスト |
| User B | `e2e-user-b@example.com` | `TestPassword123` | クロスユーザーセキュリティテスト |

**テストデータのクリーンアップ:**
- 各テストケース実行前にテストユーザーのTODOを全削除
- テスト実行後もデータベースをクリーンアップ

---

## 4. E2Eテストシナリオ一覧

### 4.1 認証フロー

#### E2E-001: ログイン成功フロー

**優先度:** ★★★（クリティカル）
**実装状況:** 未実装

**前提条件:**
- テストユーザー（User A）が登録済み

**テストステップ:**
1. ログイン画面（`/login`）にアクセス
2. メールアドレス: `e2e-user-a@example.com` を入力
3. パスワード: `TestPassword123` を入力
4. 「ログイン」ボタンをクリック

**期待結果:**
- TODOリスト画面（`/todos`）にリダイレクトされる
- ヘッダーにログアウトボタンが表示される
- 画面上部に「ようこそ！」または類似のメッセージが表示される

---

#### E2E-002: ログイン失敗（誤ったパスワード）

**優先度:** ★★☆（重要）
**実装状況:** 未実装

**前提条件:**
- テストユーザー（User A）が登録済み

**テストステップ:**
1. ログイン画面（`/login`）にアクセス
2. メールアドレス: `e2e-user-a@example.com` を入力
3. パスワード: `WrongPassword` を入力
4. 「ログイン」ボタンをクリック

**期待結果:**
- ログイン画面に留まる
- エラーメッセージ「メールアドレスまたはパスワードが正しくありません」が表示される
- 入力フィールドがクリアされない（再入力が容易）

---

#### E2E-003: ログイン失敗（存在しないユーザー）

**優先度:** ★★☆（重要）
**実装状況:** 未実装

**テストステップ:**
1. ログイン画面（`/login`）にアクセス
2. メールアドレス: `nonexistent@example.com` を入力
3. パスワード: `AnyPassword123` を入力
4. 「ログイン」ボタンをクリック

**期待結果:**
- ログイン画面に留まる
- エラーメッセージ「メールアドレスまたはパスワードが正しくありません」が表示される
- セキュリティ上、存在しないユーザーかどうかは明示しない

---

#### E2E-004: ログアウトフロー

**優先度:** ★★★（クリティカル）
**実装状況:** 未実装

**前提条件:**
- User Aでログイン済み

**テストステップ:**
1. TODOリスト画面（`/todos`）にアクセス
2. ヘッダーの「ログアウト」ボタンをクリック

**期待結果:**
- ログイン画面（`/login`）にリダイレクトされる
- 再度 `/todos` にアクセスしようとすると、ログイン画面にリダイレクトされる
- トークンがクリアされている（認証が無効化）

---

#### E2E-005: 未認証時のリダイレクト

**優先度:** ★★★（クリティカル）
**実装状況:** 未実装

**前提条件:**
- ログインしていない状態

**テストステップ:**
1. ブラウザを起動
2. TODOリスト画面（`/todos`）に直接アクセス

**期待結果:**
- ログイン画面（`/login`）にリダイレクトされる
- TODOリストは表示されない

---

### 4.2 TODO管理の基本フロー

#### E2E-010: TODO作成フロー

**優先度:** ★★★（クリティカル）
**実装状況:** 未実装

**前提条件:**
- User Aでログイン済み

**テストステップ:**
1. TODOリスト画面にアクセス
2. 「タイトル」フィールドに「買い物」を入力
3. 「詳細」フィールドに「野菜を買う」を入力
4. 「期限」フィールドに明日の日付を入力
5. 「追加」ボタンをクリック

**期待結果:**
- TODOリストに新しいTODOが表示される
- タイトル: 「買い物」
- 詳細: 「野菜を買う」
- 期限: 明日の日付
- 完了チェックボックス: 未チェック
- フォームがクリアされ、次のTODO入力が可能

---

#### E2E-011: TODO編集フロー

**優先度:** ★★★（クリティカル）
**実装状況:** 未実装

**前提条件:**
- User Aでログイン済み
- 「買い物」というTODOが1件存在

**テストステップ:**
1. TODOリスト画面にアクセス
2. 「買い物」TODOの「編集」ボタンをクリック
3. タイトルを「買い物（スーパーA）」に変更
4. 詳細を「野菜と果物を買う」に変更
5. 「更新」ボタンをクリック

**期待結果:**
- TODOリストに更新されたTODOが表示される
- タイトル: 「買い物（スーパーA）」
- 詳細: 「野菜と果物を買う」
- 編集モードが終了し、通常表示に戻る

---

#### E2E-012: TODO完了マーク切替フロー

**優先度:** ★★★（クリティカル）
**実装状況:** 未実装

**前提条件:**
- User Aでログイン済み
- 「買い物」というTODO（未完了）が1件存在

**テストステップ:**
1. TODOリスト画面にアクセス
2. 「買い物」TODOの完了チェックボックスをクリック
3. チェックボックスが✓状態になることを確認
4. 再度チェックボックスをクリック

**期待結果:**
- 1回目のクリック: チェックボックスが✓状態、TODOが完了状態（取り消し線など）
- 2回目のクリック: チェックボックスが空、TODOが未完了状態に戻る

---

#### E2E-013: TODO削除フロー

**優先度:** ★★★（クリティカル）
**実装状況:** 未実装

**前提条件:**
- User Aでログイン済み
- 「買い物」というTODOが1件存在

**テストステップ:**
1. TODOリスト画面にアクセス
2. 「買い物」TODOの「削除」ボタンをクリック
3. 確認ダイアログが表示される場合は「OK」をクリック

**期待結果:**
- TODOリストから「買い物」TODOが削除される
- 削除されたTODOは表示されない
- TODOが0件の場合、「TODOがありません」などの空状態メッセージが表示される

---

#### E2E-014: TODO作成→編集→完了→削除の一連のフロー

**優先度:** ★★★（クリティカル）
**実装状況:** 未実装

**前提条件:**
- User Aでログイン済み

**テストステップ:**
1. TODOを作成: タイトル「テスト用TODO」
2. 作成されたTODOを編集: タイトル「編集後TODO」に変更
3. 編集されたTODOを完了マーク
4. 完了マークされたTODOを削除

**期待結果:**
- 各ステップで操作が正しく反映される
- 最終的にTODOが削除され、リストから消える

---

### 4.3 TODO複数件操作

#### E2E-020: 複数TODO作成と一覧表示

**優先度:** ★★☆（重要）
**実装状況:** 未実装

**前提条件:**
- User Aでログイン済み

**テストステップ:**
1. 以下の3つのTODOを順番に作成
   - TODO 1: タイトル「買い物」、期限 明日
   - TODO 2: タイトル「レポート」、期限 3日後
   - TODO 3: タイトル「掃除」、期限 1週間後
2. TODOリストを確認

**期待結果:**
- 3つのTODOがリストに表示される
- デフォルトでは期限の昇順でソート（買い物 → レポート → 掃除）

---

#### E2E-021: 複数TODOの一括削除

**優先度:** ★☆☆（通常）
**実装状況:** 未実装

**前提条件:**
- User Aでログイン済み
- 3つのTODOが存在

**テストステップ:**
1. TODOリスト画面にアクセス
2. 各TODOを順番に削除

**期待結果:**
- すべてのTODOが削除される
- 空状態メッセージが表示される

---

### 4.4 フィルタリングとソート

#### E2E-030: フィルタリング（未完了のみ表示）

**優先度:** ★★☆（重要）
**実装状況:** 未実装

**前提条件:**
- User Aでログイン済み
- 未完了TODO 2件、完了TODO 1件が存在

**テストステップ:**
1. TODOリスト画面にアクセス（フィルタ: すべて）
2. フィルタを「未完了」に変更

**期待結果:**
- 未完了TODOのみ2件表示される
- 完了TODOは表示されない
- フィルタの件数表示が「未完了 (2)」となる

---

#### E2E-031: フィルタリング（完了のみ表示）

**優先度:** ★★☆（重要）
**実装状況:** 未実装

**前提条件:**
- User Aでログイン済み
- 未完了TODO 2件、完了TODO 1件が存在

**テストステップ:**
1. TODOリスト画面にアクセス（フィルタ: すべて）
2. フィルタを「完了」に変更

**期待結果:**
- 完了TODOのみ1件表示される
- 未完了TODOは表示されない
- フィルタの件数表示が「完了 (1)」となる

---

#### E2E-032: フィルタリング（すべて表示）

**優先度:** ★★☆（重要）
**実装状況:** 未実装

**前提条件:**
- User Aでログイン済み
- 未完了TODO 2件、完了TODO 1件が存在

**テストステップ:**
1. TODOリスト画面にアクセス（フィルタ: 未完了）
2. フィルタを「すべて」に変更

**期待結果:**
- すべてのTODO（3件）が表示される
- フィルタの件数表示が「すべて (3)」となる

---

#### E2E-033: ソート（期限昇順）

**優先度:** ★★☆（重要）
**実装状況:** 未実装

**前提条件:**
- User Aでログイン済み
- 期限がバラバラな3つのTODOが存在

**テストステップ:**
1. TODOリスト画面にアクセス
2. ソート順を「期限昇順」に設定

**期待結果:**
- 期限の早い順にTODOが並ぶ
- 期限未設定のTODOは末尾に表示される

---

#### E2E-034: ソート（期限降順）

**優先度:** ★★☆（重要）
**実装状況:** 未実装

**前提条件:**
- User Aでログイン済み
- 期限がバラバラな3つのTODOが存在

**テストステップ:**
1. TODOリスト画面にアクセス
2. ソート順を「期限降順」に設定

**期待結果:**
- 期限の遅い順にTODOが並ぶ
- 期限未設定のTODOは末尾に表示される

---

### 4.5 バリデーションエラー

#### E2E-040: TODO作成時のバリデーション（タイトル必須）

**優先度:** ★★☆（重要）
**実装状況:** 未実装

**前提条件:**
- User Aでログイン済み

**テストステップ:**
1. TODOリスト画面にアクセス
2. タイトルを空のまま、「追加」ボタンをクリック

**期待結果:**
- TODOが作成されない
- タイトルフィールドの下にエラーメッセージ「タイトルは必須です」が表示される
- フォームが送信されない

---

#### E2E-041: TODO作成時のバリデーション（タイトル最大文字数）

**優先度:** ★☆☆（通常）
**実装状況:** 未実装

**前提条件:**
- User Aでログイン済み

**テストステップ:**
1. TODOリスト画面にアクセス
2. タイトルに121文字以上の文字列を入力
3. 「追加」ボタンをクリック

**期待結果:**
- TODOが作成されない
- エラーメッセージ「タイトルは120文字以内で入力してください」が表示される

---

#### E2E-042: TODO作成時のバリデーション（期限日が過去）

**優先度:** ★★☆（重要）
**実装状況:** 未実装

**前提条件:**
- User Aでログイン済み

**テストステップ:**
1. TODOリスト画面にアクセス
2. タイトル: 「過去のTODO」を入力
3. 期限: 昨日の日付を入力
4. 「追加」ボタンをクリック

**期待結果:**
- TODOが作成されない
- エラーメッセージ「期限日は今日以降の日付を指定してください」が表示される

---

#### E2E-043: TODO作成時のバリデーション（詳細最大文字数）

**優先度:** ★☆☆（通常）
**実装状況:** 未実装

**前提条件:**
- User Aでログイン済み

**テストステップ:**
1. TODOリスト画面にアクセス
2. タイトル: 「テストTODO」を入力
3. 詳細: 1001文字以上の文字列を入力
4. 「追加」ボタンをクリック

**期待結果:**
- TODOが作成されない
- エラーメッセージ「詳細は1000文字以内で入力してください」が表示される

---

### 4.6 セキュリティ

#### E2E-050: クロスユーザーセキュリティ（TODOの隔離）

**優先度:** ★★★（クリティカル）
**実装状況:** 未実装

**前提条件:**
- User Aでログイン済み、TODO 1件作成済み
- User Bでログイン可能

**テストステップ:**
1. User Aでログイン
2. TODO「User AのプライベートTODO」を作成
3. ログアウト
4. User Bでログイン
5. TODOリストを確認

**期待結果:**
- User BのTODOリストにUser AのTODOが表示されない
- User Bは自分のTODOのみ閲覧可能

---

#### E2E-051: トークン有効期限切れ後の動作

**優先度:** ★★☆（重要）
**実装状況:** 未実装

**前提条件:**
- User Aでログイン済み

**テストステップ:**
1. User Aでログイン
2. トークンの有効期限が切れるまで待機（または手動でトークンを無効化）
3. TODO作成を試みる

**期待結果:**
- 自動的にトークンがリフレッシュされる、または
- ログイン画面にリダイレクトされる
- エラーメッセージが表示される

**注:** トークンリフレッシュの実装状況に応じて期待結果が異なる

---

### 4.7 エラーハンドリング

#### E2E-060: ネットワークエラー時の動作

**優先度:** ★☆☆（通常）
**実装状況:** 未実装

**前提条件:**
- User Aでログイン済み

**テストステップ:**
1. TODOリスト画面にアクセス
2. ネットワークをオフラインに設定（Playwrightの機能を使用）
3. TODO作成を試みる

**期待結果:**
- エラーメッセージ「ネットワークエラーが発生しました」が表示される
- ユーザーに再試行を促すメッセージが表示される

---

#### E2E-061: サーバーエラー時の動作

**優先度:** ★☆☆（通常）
**実装状況:** 未実装

**前提条件:**
- User Aでログイン済み

**テストステップ:**
1. TODOリスト画面にアクセス
2. バックエンドサーバーを停止（またはモックで500エラーを返す）
3. TODO作成を試みる

**期待結果:**
- エラーメッセージ「サーバーエラーが発生しました」が表示される
- アプリケーションがクラッシュしない

---

### 4.8 パフォーマンスとUI/UX

#### E2E-070: 大量TODO表示時のパフォーマンス

**優先度:** ★☆☆（通常）
**実装状況:** 未実装

**前提条件:**
- User Aでログイン済み
- 100件のTODOが存在

**テストステップ:**
1. TODOリスト画面にアクセス
2. ページの読み込み時間を計測

**期待結果:**
- ページが3秒以内に読み込まれる
- UIがスムーズに動作する（スクロール、フィルタリング）

---

#### E2E-071: フォームのリアルタイムバリデーション

**優先度:** ★☆☆（通常）
**実装状況:** 未実装

**前提条件:**
- User Aでログイン済み

**テストステップ:**
1. TODOリスト画面にアクセス
2. タイトルフィールドに文字を入力
3. フォーカスを外す（blur）

**期待結果:**
- バリデーションエラーがリアルタイムで表示される（フォーム送信前）
- エラーメッセージが適切に表示される

---

## 5. テスト優先度マトリクス

### 5.1 優先度別テストケース数

| 優先度 | テストケース数 | 説明 |
|-------|-------------|------|
| ★★★（クリティカル） | 10 | 必須実行、リリースブロッカー |
| ★★☆（重要） | 9 | 重要機能、プルリクエスト時に実行 |
| ★☆☆（通常） | 5 | 定期的に実行、リリース前に実行 |

### 5.2 機能別テストケース数

| 機能カテゴリ | テストケース数 |
|------------|-------------|
| 認証フロー | 5 |
| TODO管理の基本フロー | 5 |
| TODO複数件操作 | 2 |
| フィルタリングとソート | 5 |
| バリデーションエラー | 4 |
| セキュリティ | 2 |
| エラーハンドリング | 2 |
| パフォーマンスとUI/UX | 2 |
| **合計** | **27** |

---

## 6. テスト実装ガイド

### 6.1 テストファイル構成（推奨）

```
frontend/
  e2e/
    tests/
      auth/
        login.spec.ts              # E2E-001 ~ E2E-005
        logout.spec.ts
      todos/
        crud.spec.ts               # E2E-010 ~ E2E-014
        multiple.spec.ts           # E2E-020 ~ E2E-021
        filtering.spec.ts          # E2E-030 ~ E2E-034
        validation.spec.ts         # E2E-040 ~ E2E-043
      security/
        cross-user.spec.ts         # E2E-050 ~ E2E-051
      errors/
        error-handling.spec.ts     # E2E-060 ~ E2E-061
      performance/
        performance.spec.ts        # E2E-070 ~ E2E-071
    fixtures/
      auth.ts                      # 認証ヘルパー関数
      todos.ts                     # TODOテストデータ生成
    playwright.config.ts
```

### 6.2 実装例（Playwright）

#### ログインヘルパー関数

```typescript
// e2e/fixtures/auth.ts
import { Page } from '@playwright/test';

export async function login(page: Page, email: string, password: string) {
  await page.goto('/login');
  await page.fill('input[type="email"]', email);
  await page.fill('input[type="password"]', password);
  await page.click('button[type="submit"]');
  await page.waitForURL('/todos');
}
```

#### テストケース例

```typescript
// e2e/tests/auth/login.spec.ts
import { test, expect } from '@playwright/test';
import { login } from '../../fixtures/auth';

test('E2E-001: ログイン成功フロー', async ({ page }) => {
  await login(page, 'e2e-user-a@example.com', 'TestPassword123');

  // TODOリスト画面にリダイレクト
  await expect(page).toHaveURL('/todos');

  // ログアウトボタンが表示される
  await expect(page.locator('button:has-text("ログアウト")')).toBeVisible();
});

test('E2E-002: ログイン失敗（誤ったパスワード）', async ({ page }) => {
  await page.goto('/login');
  await page.fill('input[type="email"]', 'e2e-user-a@example.com');
  await page.fill('input[type="password"]', 'WrongPassword');
  await page.click('button[type="submit"]');

  // エラーメッセージが表示される
  await expect(page.locator('text=メールアドレスまたはパスワードが正しくありません')).toBeVisible();

  // ログイン画面に留まる
  await expect(page).toHaveURL('/login');
});
```

### 6.3 テスト実行コマンド

**すべてのE2Eテストを実行:**
```bash
pnpm --dir frontend run test:e2e
```

**特定のテストファイルを実行:**
```bash
pnpm --dir frontend run test:e2e -- auth/login.spec.ts
```

**ヘッドレスモードで実行:**
```bash
pnpm --dir frontend run test:e2e:headless
```

**デバッグモード（ブラウザを表示）:**
```bash
pnpm --dir frontend run test:e2e:debug
```

---

## 7. テストデータ管理

### 7.1 テストユーザーのセットアップ

**セットアップスクリプト:**
```bash
# テストユーザーを作成
make db-create-user EMAIL=e2e-user-a@example.com PASSWORD=TestPassword123
make db-create-user EMAIL=e2e-user-b@example.com PASSWORD=TestPassword123
```

### 7.2 テストデータのクリーンアップ

**各テスト実行前:**
```typescript
// e2e/fixtures/cleanup.ts
import { Page } from '@playwright/test';
import { login } from './auth';

export async function cleanupTodos(page: Page, email: string, password: string) {
  await login(page, email, password);
  await page.goto('/todos');

  // すべてのTODOを削除
  while (await page.locator('button:has-text("削除")').count() > 0) {
    await page.locator('button:has-text("削除")').first().click();
  }
}
```

---

## 8. CI/CD統合

### 8.1 GitHub Actions設定例

```yaml
# .github/workflows/e2e-tests.yml
name: E2E Tests

on:
  pull_request:
    branches: [main]

jobs:
  e2e:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3

      - name: Start Docker Compose
        run: make up

      - name: Wait for services
        run: |
          timeout 60 bash -c 'until curl -f http://localhost:3000; do sleep 1; done'

      - name: Run E2E tests
        run: pnpm --dir frontend run test:e2e:ci

      - name: Upload test results
        if: always()
        uses: actions/upload-artifact@v3
        with:
          name: playwright-report
          path: frontend/playwright-report/
```

---

## 9. 今後の拡張予定

### 9.1 未実装のテストシナリオ

| 機能 | テストシナリオ | 優先度 |
|------|-------------|-------|
| **TODO共有機能** | 他のユーザーとTODOを共有 | ★★☆ |
| **TODO検索機能** | タイトル・詳細で検索 | ★★☆ |
| **TODOタグ機能** | タグでフィルタリング | ★☆☆ |
| **通知機能** | 期限が近づいたら通知 | ★☆☆ |

### 9.2 パフォーマンステスト

| テスト項目 | 目標値 |
|-----------|-------|
| **ページ読み込み時間** | 3秒以内 |
| **API応答時間** | 1秒以内 |
| **大量TODO表示（100件）** | 3秒以内 |

---

## 10. 関連ドキュメント

- [テスト戦略書](./06_testing-strategy.md) - テストピラミッド、テストレベル
- [機能一覧](./03_feature-list.md) - 実装済み機能一覧
- [システム構成設計書](./01_system-architecture.md) - システムアーキテクチャ
- [認証・認可設計書](./02_authentication-authorization.md) - 認証フロー、セキュリティ

---

**END OF DOCUMENT**
