# 環境構築の具体化

## モノレポ構成とディレクトリ方針
- ルート直下に `frontend/` (React + TypeScript), `backend/` (Flask + Python), `infra/` (Docker関連設定) を配置する。
- 共通設定用にルートに `.editorconfig`, `.gitignore`, `README.md`, `Makefile` (もしくは `justfile`) を用意し、開発コマンドを一元管理する。
- 依存管理ファイル (`package.json`, `poetry.lock` など) は各アプリのサブディレクトリ配下に置き、ルートには置かない。

## Docker / Docker Compose
- `infra/docker-compose.yml` を作成し、以下のサービスを定義する。
  - `frontend`: Node.js 20 ベース、Vite開発サーバをホスト側ポート `5173` に公開。ソースはボリュームでマウントし、ホットリロードを有効化。
  - `backend`: Python 3.12 ベース、Flaskアプリを `gunicorn` or `flask run` で起動。ホスト側ポート `5000` に公開。Poetry で依存を管理し、ソースをマウント。
  - `db`: MySQL 8.0 系。環境変数で `MYSQL_DATABASE`, `MYSQL_USER`, `MYSQL_PASSWORD`, `MYSQL_ROOT_PASSWORD` を設定し、データ永続化用に `mysql-data` ボリュームを割り当て。
- 共通ネットワーク `app-network` を設定し、サービス間通信をコンテナ名で解決できるようにする。
- 開発用の `env` ファイル (`infra/.env.development`) を読み込むように `docker-compose.yml` を設定する。
- 必要に応じて `backend` 用に Alembic 等のマイグレーションツールコンテナを追加できるようコメントで指針を残す。

## フロントエンド (React + TypeScript)
- Vite + React + TypeScript テンプレートでアプリを初期化する。
- パッケージマネージャは `pnpm` を採用 (高速性とロックファイルの扱いやすさから)。ルートの `Makefile` 経由で `pnpm` コマンドを実行する。
- 主要依存: React 18, React DOM 18, TypeScript 5, ESLint, Prettier, Vitest, Testing Library。
- `tsconfig.json` を設定し、`paths` でエイリアス (`@/`) を定義する。
- `src/` 配下は `components/`, `pages/`, `hooks/`, `lib/`, `styles/` などに分割。
- 開発コマンド:
  - `pnpm dev`: Vite 開発サーバ起動。
  - `pnpm build`: 本番ビルド。
  - `pnpm test`: `vitest` 実行。
  - `pnpm lint`: ESLint、`pnpm format`: Prettier。

## バックエンド (Flask + Python)
- Python 3.12 ベースで Poetry を使用して依存管理を行う。`pyproject.toml` に Flask 2.x, SQLAlchemy 2.x, mysqlclient (or async向けに aiomysql + SQLAlchemy)、pytest, mypy, black, isort, flake8 を記載。
- アプリ構成: `backend/app/` に `main.py`, `routes/`, `services/`, `models/`, `schemas/` (Pydantic or Marshmallow) を配置。設定ファイル `config.py` で環境変数に応じた設定を行う。
- `Flask` は `.env` (python-dotenv) を読み込むよう設定し、DB 接続文字列は `mysql+pymysql://user:password@db:3306/app_db` 形式で管理。
- フォーマッタ & リンター設定:
  - `black`, `isort` をフォーマッタとして使用。
  - `flake8`, `mypy` を静的解析に使用し、`pyproject.toml` で設定統合。
- テストランナーとして `pytest` を採用し、`tests/` ディレクトリを用意。DB を使うテストでは一時テーブル or トランザクションロールバックを行う。

## データベース (MySQL)
- MySQL 8.0 をDockerコンテナで起動。文字コードは `utf8mb4`, 照合順序は `utf8mb4_general_ci` を標準とする。
- 初期化SQLを `infra/mysql/init/` に格納し、`docker-entrypoint-initdb.d` で読み込ませる。
- 設定ファイル `my.cnf` を `infra/mysql/conf.d/` に配置し、ローカル開発に必要な最低限の設定 (タイムゾーン, sql_mode, max_connections) を明示する。

## 開発フローとコマンド標準化
- ルートの `Makefile` で主要コマンドを定義:
  - `make install`: `pnpm install` (frontend) と `poetry install` (backend)。
  - `make up`: `docker compose up -d` (infra配下)。
  - `make down`: `docker compose down`。
  - `make lint`: frontend+backend のリンター実行。
  - `make test`: frontend (`pnpm test`) と backend (`poetry run pytest`) をシーケンシャルに実行。
  - `make format`: 各フォーマッタ実行。
- 開発者がよく使う手順を `docs/development.md` にまとめ、環境変数の設定やトラブルシューティングも記載。

## Git 設定
- ルートに `.gitignore` を配置し、Node.js, Python, Docker, IDE などで生成されるファイルを除外。
- Git hooks: `pre-commit` を導入し、フォーマット・Lint・テスト (高速なもの) をコミット前に実行するよう `.pre-commit-config.yaml` を用意。
- コミットメッセージ規約 (Conventional Commits など) を README に記載し、可能であれば `commitlint` を導入。

## 共有開発環境の考慮事項
- `.env.example` を `frontend`, `backend`, `infra` 配下に用意し、環境変数の共通化を行う。敏感情報は `.env.local` など各自管理に任せる。
- 開発環境構築手順を `README.md` に記載し、初回セットアップ〜コンテナ起動までの手順を明文化。
- CI (GitHub Actions など) の導入前提で、`lint` と `test` を実行するワークフローファイル案 (`.github/workflows/ci.yml`) を設計に含める。

