# 環境構築タスクチェックリスト

`docs/環境構築具体化.md` の内容を実装するためのタスク群です。各タスクを完了したら、記載の動作確認を実行して結果を確認してください。

## モノレポ構成と共通設定
- [ ] ルート直下に `frontend/`, `backend/`, `infra/` ディレクトリを作成し、必要に応じてプレースホルダーファイルを配置する。
  - 動作確認: `ls frontend backend infra` を実行して各ディレクトリが存在することを確認する。
- [ ] ルートに `.editorconfig` を作成し、共通のインデント・改行ルールを定義する。
  - 動作確認: `test -f .editorconfig && rg "root = true" .editorconfig` が成功することを確認する。
- [ ] ルートに `.gitignore` を作成し、Node.js / Python / Docker / IDE 由来の不要ファイルを網羅する。
  - 動作確認: `rg "node_modules" .gitignore && rg "__pycache__" .gitignore` がマッチすることを確認する。
- [ ] ルートに `README.md` を作成し、モノレポ構成とセットアップ概要を記載する。
  - 動作確認: `rg "frontend/" README.md && rg "backend/" README.md` がマッチすることを確認する。

## Docker / Docker Compose
- [ ] `infra/docker-compose.yml` を作成し、`frontend`, `backend`, `db` サービスと `app-network` ネットワークを定義する。
  - 動作確認: `docker compose -f infra/docker-compose.yml config` がエラーなく出力されることを確認する。
- [ ] `frontend` サービスを Node.js 20 ベースで構築し、Vite 開発サーバをホスト `5173` に公開する。
  - 動作確認: `docker compose -f infra/docker-compose.yml run --rm frontend node -v` で Node.js バージョンが表示されることを確認する。
- [ ] `backend` サービスを Python 3.12 ベースで構築し、Flask アプリを起動できるよう `command` を設定する。
  - 動作確認: `docker compose -f infra/docker-compose.yml run --rm backend python --version` が 3.12 系を表示することを確認する。
- [ ] `db` サービスに MySQL 8.0、環境変数、永続化ボリューム `mysql-data` を定義する。
  - 動作確認: `docker compose -f infra/docker-compose.yml up -d db` 実行後に `docker compose exec db mysql -e "SHOW DATABASES;"` で `information_schema` などが表示されることを確認する。
- [ ] `infra/.env.development` を作成し、 Compose で読み込むよう設定する。
  - 動作確認: `grep MYSQL_ infra/.env.development` が想定の環境変数を出力すること、および `docker compose --env-file infra/.env.development config` が成功することを確認する。
- [ ] Alembic 等のマイグレーションコンテナ追加に関する指針を `docker-compose.yml` 内コメントで残す。
  - 動作確認: `rg "# Alembic" infra/docker-compose.yml` がマッチすることを確認する。

## フロントエンド (React + TypeScript)
- [ ] `frontend/` 配下で Vite + React + TypeScript プロジェクトを `pnpm create vite` で初期化する。
  - 動作確認: `pnpm -C frontend run dev --host 0.0.0.0 --port 5173` を実行し、開発サーバが起動することを確認する。
- [ ] `package.json` に React 18 / TypeScript 5 / ESLint / Prettier / Vitest / Testing Library 等の依存を追加する。
  - 動作確認: `pnpm -C frontend list react typescript eslint prettier vitest @testing-library/react` がインストール済みバージョンを表示することを確認する。
- [ ] `tsconfig.json` に `paths` を設定し、`@/` エイリアスを追加する。
  - 動作確認: `jq '.compilerOptions.paths' frontend/tsconfig.json` が `@/*` の設定を含むことを確認する。
- [ ] `src/components`, `src/pages`, `src/hooks`, `src/lib`, `src/styles` ディレクトリを作成する。
  - 動作確認: `ls frontend/src` で各ディレクトリが表示されることを確認する。
- [ ] `package.json` のスクリプトに `pnpm dev`, `pnpm build`, `pnpm test`, `pnpm lint`, `pnpm format` を定義する。
  - 動作確認: `pnpm -C frontend run lint` と `pnpm -C frontend run test -- --runInBand` が成功することを確認する。
- [ ] ESLint / Prettier / Vitest / Testing Library 用の設定ファイル (`.eslintrc`, `.prettierrc`, `vitest.config.ts` 等) を整備する。
  - 動作確認: `pnpm -C frontend run format --check` および `pnpm -C frontend run test` が成功することを確認する。

## バックエンド (Flask + Python)
- [ ] `backend/` で Poetry プロジェクトを初期化し、Flask 2.x, SQLAlchemy 2.x, mysqlclient (もしくは pymysql), pytest, mypy, black, isort, flake8 を依存として追加する。
  - 動作確認: `poetry -C backend show flask sqlalchemy mysqlclient pytest mypy black isort flake8` がインストール済みであることを確認する。
- [ ] `backend/app/` に `main.py`, `routes/`, `services/`, `models/`, `schemas/`, `config.py` を配置する。
  - 動作確認: `ls backend/app` が各ディレクトリとファイルを表示することを確認する。
- [ ] Flask が `.env` を読み込み、`mysql+pymysql://user:password@db:3306/app_db` の形式で DB 接続を設定できるよう実装する。
  - 動作確認: `poetry -C backend run flask --app app.main routes` を実行し、アプリが読み込まれることを確認する。
- [ ] `pyproject.toml` に black / isort / flake8 / mypy の設定を統合する。
  - 動作確認: `poetry -C backend run black --check backend` と `poetry -C backend run mypy backend` が成功することを確認する。
- [ ] `backend/tests/` ディレクトリを作成し、pytest 用の初期テストと DB を使わないサンプルを追加する。
  - 動作確認: `poetry -C backend run pytest` が成功することを確認する。

## データベース (MySQL)
- [ ] `infra/mysql/init/` に初期化 SQL を配置し、`docker-compose.yml` で `docker-entrypoint-initdb.d` にマウントする。
  - 動作確認: `docker compose exec db mysql -e "SHOW TABLES FROM app_db;"` が初期テーブルを表示することを確認する。
- [ ] `infra/mysql/conf.d/` に `my.cnf` を配置し、文字コード `utf8mb4`・照合順序 `utf8mb4_general_ci`・タイムゾーン等を設定する。
  - 動作確認: `docker compose exec db mysql -e "SHOW VARIABLES LIKE 'character_set_server';"` が `utf8mb4` を返すことを確認する。

## 開発フローとコマンド標準化
- [ ] ルートの `Makefile` に `install`, `up`, `down`, `lint`, `test`, `format` ターゲットを定義し、`pnpm` や `poetry` コマンドをラップする。
  - 動作確認: `make -n install`, `make -n lint`, `make -n test` が意図したコマンドを表示することを確認する。
- [ ] 開発手順・トラブルシューティング・環境変数設定を `docs/development.md` にまとめる。
  - 動作確認: `rg "環境変数" docs/development.md` および `rg "トラブルシューティング" docs/development.md` がマッチすることを確認する。

## Git 設定
- [ ] ルート `.gitignore` に Node.js / Python / Docker / IDE 由来の不要ファイルを追加し、既存リポジトリに適用する。
  - 動作確認: `git status --ignored` を実行し、`node_modules/` や `__pycache__/` が無視されていることを確認する。
- [ ] `.pre-commit-config.yaml` を作成し、フォーマッタ・リンター・テストの高速チェックを登録する。
  - 動作確認: `poetry -C backend run pre-commit install` 実行後、`pre-commit run --all-files` が成功することを確認する。
- [ ] README に Conventional Commits などのコミットメッセージ規約を追記し、必要であれば `commitlint` の導入手順を記載する。
  - 動作確認: `rg "Conventional Commits" README.md` がマッチすること、`pnpm -C frontend commitlint --help` が実行できることを確認する。

## 共有開発環境と CI
- [ ] `frontend`, `backend`, `infra` 各ディレクトリに `.env.example` を作成し、必要な環境変数を明示する。
  - 動作確認: `test -s frontend/.env.example && test -s backend/.env.example && test -s infra/.env.example` が成功することを確認する。
- [ ] `README.md` に初回セットアップからコンテナ起動までの手順を追記する。
  - 動作確認: `rg "docker compose up" README.md` がマッチすることを確認する。
- [ ] `.github/workflows/ci.yml` を作成し、`lint` と `test` を実行する CI ワークフローを設計する。
  - 動作確認: `yq '.jobs' .github/workflows/ci.yml` が lint / test ジョブを含むこと、`gh workflow run ci.yml --dry-run` が成功することを確認する。
